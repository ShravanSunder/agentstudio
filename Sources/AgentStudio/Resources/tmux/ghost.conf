# Ghost tmux — invisible session daemon for Agent Studio
# Minimal config: let Ghostty handle all terminal features (mouse, focus, resize).
# tmux only provides PTY persistence across app restarts.

# No prefix key — tmux won't intercept any keystrokes
set -g prefix None

# No visual chrome
set -g status off

# Use xterm-256color, NOT xterm-ghostty. When tmux detects xterm-ghostty it
# enables Kitty keyboard protocol handling that conflicts with GhosttyKit's
# own keyboard input, causing every keystroke to be doubled.
# This mirrors Ghostty's own fallback in Exec.zig when terminfo is unavailable.
# See: https://github.com/ghostty-org/ghostty/issues/3335
set -g default-terminal "xterm-256color"

# Restore visual capabilities lost by using xterm-256color instead of xterm-ghostty.
# Escape sequences sourced from vendor/ghostty/src/terminfo/ghostty.zig.
# Kitty keyboard protocol (fullkbd) is deliberately excluded.
set -as terminal-overrides ",xterm-256color:RGB"
set -as terminal-overrides ',xterm-256color:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',xterm-256color:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Explicitly disable extended keys to prevent keyboard protocol conflicts
# between tmux and GhosttyKit's native keyboard handling.
set -g extended-keys off

# Enable mouse support so tmux forwards scroll/click events correctly.
set -g mouse on

# No escape delay — immediate key processing
set -g escape-time 0

# Large scrollback for session persistence
set -g history-limit 50000

# Keep sessions alive when last client detaches
set -g destroy-unattached off
set -g exit-unattached off

# Unset TMUX so user can run their own tmux inside ghost sessions
set-environment -g -u TMUX
