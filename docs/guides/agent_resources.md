# Agent Resources & Research Guide

This guide provides grounded context, setup procedures, and research tools for agents working on the Agent Studio codebase.

## First-Time Setup (Fresh Clone / New Worktree)

A fresh worktree or clone cannot build or test without completing these steps first. The project depends on two git submodules (`vendor/ghostty`, `vendor/zmx`) and several generated artifacts that are gitignored.

### Prerequisites

- **mise** — build orchestrator: `brew install mise`
- **swift-format** — code formatter: `brew install swift-format`
- **swiftlint** — linter: `brew install swiftlint`

### Bootstrap Steps

Run these in order from the project root:

```bash
# 1. Populate git submodules (empty directories without this)
git submodule update --init --recursive

# 2. Install pinned tool versions (zig 0.15.2)
mise install

# 3. Full build — ghostty xcframework + zmx + dev resources + swift
mise run build
```

### What Gets Generated (All Gitignored)

| Artifact | Generated by | Required for |
|----------|-------------|--------------|
| `Frameworks/GhosttyKit.xcframework` | `mise run build-ghostty` + `copy-xcframework` | `swift build` (SPM binary target) |
| `Sources/AgentStudio/Resources/ghostty/shell-integration/` | `mise run setup-dev-resources` | Runtime shell integration |
| `Sources/AgentStudio/Resources/terminfo/` | `mise run setup-dev-resources` | Runtime terminfo entries |
| `vendor/zmx/zig-out/bin/zmx` | `mise run build-zmx` | Session multiplexer backend |

If any of these are missing, the corresponding build or runtime step will fail. `mise run build` generates all of them via its dependency chain.

### Verifying the Setup

```bash
# Confirm submodules are populated
ls vendor/ghostty/build.zig vendor/zmx/build.zig

# Confirm xcframework exists
ls Frameworks/GhosttyKit.xcframework

# Run tests
mise run test
```

## DeepWiki Knowledge Base
Use DeepWiki to gather grounded context on core dependencies and libraries.

- **Ghostty (Core Terminal)**: `ghostty-org/ghostty`
  - *Usage*: `wiki_question(repo: "ghostty-org/ghostty", question: "...")`
  - *Focus*: C API, terminal emulation logic, Zig build system.
- **Swift (Language)**: `swiftlang/swift`
  - *Usage*: `wiki_question(repo: "swiftlang/swift", question: "...")`
  - *Focus*: Language features, standard library, runtime behavior.

## Documentation Links
- **Ghostty Docs**: [https://ghostty.org/docs](https://ghostty.org/docs)
- **Swift.org**: [https://www.swift.org/documentation/](https://www.swift.org/documentation/)
- **Apple Developer Docs**: [https://developer.apple.com/documentation/](https://developer.apple.com/documentation/)
  - [AppKit](https://developer.apple.com/documentation/appkit)
  - [SwiftUI](https://developer.apple.com/documentation/swiftui)
  - [Metal](https://developer.apple.com/documentation/metal)
  - [Foundation](https://developer.apple.com/documentation/foundation)

## Research Guidance

### C API / Interop
When working on `Ghostty.swift` or `GhosttySurfaceView.swift`, verify C function signatures and memory management patterns in the Ghostty repo. Pay close attention to pointer ownership and lifetime.

### AppKit Patterns
For UI changes in `Sources/AgentStudio/App/`, refer to Apple's AppKit documentation for native macOS behaviors. This includes the responder chain, window delegation, and menu management.

### Zig Build System
Ghostty and zmx are built via mise tasks (`mise run build-ghostty`, `mise run build-zmx`), which invoke `zig build` inside the vendor directories. If investigating build options or optimization flags, check `vendor/ghostty/build.zig` and `vendor/zmx/build.zig`.

### Swift Concurrency
The project targets **macOS 26 only** (`.macOS(.v26)` in `Package.swift`). Use the latest Swift 6 concurrency features (async/await, Actors, `@MainActor`, `AsyncStream`). Refer to the [Swift Language Guide](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/concurrency/) for best practices.
